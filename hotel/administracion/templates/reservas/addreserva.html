{% extends 'layout_administrador.html' %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.1/css/select.dataTables.min.css">
<div>
    <!-- ============================================================== 
    <div class="row">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
            <div class="page-header">
                <h2 class="pageheader-title">Reserva manual </h2>
            </div>
        </div>
    </div>-->
    <!-- ============================================================== -->
    <!-- end pageheader  -->
    <!-- ============================================================== -->
    <div class="row">
        <!--  <div class="col-lg-10">
            <button data-toggle="modal" data-target="#cliente" class="btn btn-primary btn-agregar-adm">
                <i class="fas fa-search"></i> Buscar cliente
            </button>
           
            <div class="modal fade" id="cliente" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle"
                aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle">Search</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <input type="text" class="form-control" name="nombres" id="inputnombres"
                                placeholder="Nombres" value="" required="required">
                        </div>
                        <div class="modal-footer">

                            <button type="button" onclick="buscarcliente()" class="btn btn-primary">Buscar</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>-->
    </div>
    <br>

    <div class="row">
        <div class="card">
            <h5 class="card-header">                
                <span style="vertical-align: inherit;">Reserva: </span>
            </h5>
            <div class="card-body">

                <form action="/administracion/agregar_reserva" class="form-style" method="POST">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-xl-6 col-md-6 col-sm-6">
                            <div class="form-group">
                                <label for="dropdown-docs">Tipo de Documento de Identificacion</label>
                                <select id="dropdown-docs" name="dropwdown-docs" class="form-control">
                                    {% for tipo_doc,tipo_doc_humano in choices_id %}
                                    <option value="{{tipo_doc}}">{{tipo_doc_humano}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xl-6 col-md-6 col-sm-6 ">
                            <div class="form-group">
                                <label for="ced">Documento</label>
                                <input type="text" class="form-control" name="cedula" id="cedula"
                                    placeholder="Ingrese su Documento" value="" required="required" maxlength="10"
                                    onkeyup="this.value=this.value.replace(/[^\d]/,'')">
                            </div>
                        </div>
                    </div>
                    <div class="row">

                        <div class="col-xl-6 col-md-6 col-sm-6 ">
                            <div class="form-group">
                                <label for="nomb">Nombres</label>
                                <input type="text" class="form-control" name="nombres" id="nombres" placeholder=""
                                    value="" required="required" disabled>
                            </div>
                        </div>
                        <div class="col-xl-6 col-md-6 col-sm-6 ">
                            <div class="form-group">
                                <label for="apellidos">Apellidos</label>
                                <input type="text" class="form-control" name="apellidos" id="apellidos" placeholder=""
                                    value="" required="required" disabled>
                            </div>
                        </div>

                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 ">
                            <div class="form-group">
                                <label for="fecha_nacimiento">Fecha de nacimiento</label>
                                <input type="date" class="form-control" name="fecha_nacimiento" id="fecha_nacimiento"
                                    value="" placeholder="" required="required" disabled>
                            </div>
                        </div>
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 ">
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" class="form-control" name="email" id="email" value="" placeholder=""
                                    required="required" disabled>
                            </div>
                        </div>
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 ">
                            <div class="form-group">
                                <label for="telf">Teléfono</label>
                                <input type="tel" pattern="[0-9]{10}" class="form-control" name="telf" id="telf"
                                    value="" placeholder="" required="required" disabled>
                            </div>
                        </div>


                    </div>
                    <div class="row">
                        <div class="col-xl-6 col-md-6">
                            <div class="form-group">
                                <label for="fechain">Fecha de ingreso</label>
                                <input type="text" class="form-control" id="fechain" name="fechain" required>
                                <!-- <input type="date" class="form-control" name="fechain" id="fechain" value=""
                                    placeholder="" required="required">
                                <input type="number" class="form-control" name="estado" id="estado" hidden> -->
                            </div>
                        </div>
                        <div class="col-xl-6 col-md-6">
                            <div class="form-group">
                                <label for="fechasal">Fecha de salida</label>
                                <input type="text" class="form-control" id="fechasal" name="fechasal" required>
                                <!-- <input type="date" class="form-control" name="fechasal" id="fechasal" value=""
                                    placeholder="" required="required"> -->
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h5 class="card-header">                            
                            <span style="vertical-align: inherit;">Habitacion </span>                            
                        </h5>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-xl-4 col-md-4">                                    
                                    <label for="select_tipo_habitacion">Tipo</label>
                                    <select name="select_tipo_habitacion" id="select_tipo_habitacion" class="form-control">
                                        {% for type in room_type %}
                                            <option value={{ type.id }}>{{ type.nombre }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-xl-4 col-md-4">
                                    <label for="Adultos">Adultos</label>
                                    <input class="form-control" type="number" name="habitacion" id="adultos" value="0" placeholder="" required>
                                </div>
                                <div class="col-xl-4 col-md-4">
                                    <label for="niños">Niños</label>
                                    <input class="form-control" type="number" name="habitacion" id="ninos" value="0" placeholder="" required>
                                </div>
                            </div>                            
                            <div class="row" style="margin-top:10px; margin-bottom:10px;">
                                <div class="col-xl-12 col-md-12">
                                    <button style="width: 100%;" type="button" class="btn btn-primary" onclick=buscarhabitacion()><i class="fas fa-search"></i> BUSCAR</button>
                                </div>                                
                            </div>                
                        
                            <div class="row">
                                <div class="table-responsive">
                                    <table id="table-rooms" class="table table-striped table-bordered first">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th>ID</th>
                                                <th>Nombre</th>
                                                <th>Numero</th>
                                                <th>Descripcion</th>
                                                <th>Precio</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                        </div>
                        <div class="form-group">
                            <button type="submit"
                                class="btn btn-primary btn-block login-btn border-button">Guardar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% block scripts %}
    <!-- block.super will get the content of the block from the parent template -->
    {{ block.super }}
    <script>
        $(document).ready(function () {
            $('#fechain').datetimepicker();
            $('#fechasal').datetimepicker();
            $("#cedula").change(function () {

                var cedula = $('#cedula').val();
                var tipo_documento = $('#dropdown-docs').val();

                var nombres = $("#nombres").val;
                var apellidos = $("#apellidos").val;
                var fn = $("#fecha_nacimiento").val;
                var emai = $("#email").val();
                var telefono = $("#telf").val;
                $.ajax({

                    url: '/administracion/buscarcliente/',
                    data: {
                        'cedula': cedula,
                        'tipo_documento': tipo_documento,
                    },
                    dataType: 'json',
                    success: function (result) {
                        if (result.existe) {

                            $("#nombres").val(result.nombres)
                            $("#apellidos").val(result.apellidos)
                            $("#fecha_nacimiento").val(result.fecha_nacimiento)
                            $("#email").val(result.email)
                            $("#telf").val(result.telefono)
                        }
                        else {

                            $("#nombres").removeAttr('disabled');
                            $("#apellidos").removeAttr('disabled');
                            $("#fecha_nacimiento").removeAttr('disabled');
                            $("#email").removeAttr('disabled');
                            $("#telf").removeAttr('disabled');
                            $("#nombres").val('');
                            $("#apellidos").val('');
                            $("#fecha_nacimiento").val('');
                            $("#email").val('');
                            $("#telf").val('');
                        }
                    },
                        error: function () { alert('An error occured'); }
                    });
                });

            $('#dropdown-docs').on('change', function () {
                $('#cedula').val("");
                $("#nombres").val("")
                $("#apellidos").val("")
                $("#fecha_nacimiento").val("")
                $("#email").val("")
                $("#telf").val("")
            });
        })
        
        function buscarhabitacion() {
            var tipo = $("#select_tipo_habitacion").val();
            var fechain = $("#fechain").val();
            var fechaout = $("#fechasal").val();
            var ninos = $("#ninos").val();
            var adultos = $("#adultos").val();
            let data = {
                    'select_num_ninos': ninos,
                    'select_num_adultos': adultos,
                    'fechain': fechain,
                    'fechaout': fechaout,
                    'tipo': tipo
            };

            console.log(data);
            $.ajax({

                url: '/administracion/buscarhabitaciones/',
                data: {
                    'select_num_ninos': ninos,
                    'select_num_adultos': adultos,
                    'fechain': fechain,
                    'fechaout': fechaout,
                    'tipo': tipo
                },
                dataType: 'json',
                success: function (result) {
                    if(!result.error){
                        var table = $('#table-rooms');
                        table.find("tbody tr").remove();
                        var data = [];
                        result.data.forEach(function (room) {
                            var data_room = [];
                            data_room.push('');
                            data_room.push(room.id);
                            data_room.push(room.nombre);
                            data_room.push(room.numero);
                            data_room.push(room.descripcion);
                            data_room.push(room.precio);
                            data.push(data_room)
                            /* table.append("<tr><td></td><td>"+room.id+"</td><td>"+room.nombre+"</td><td>"+room.numero+"</td><td>"+room.descripcion+"</td><td>"+room.precio+"</td></tr>"); */
                        })

                        console.log(data);

                        $('#table-rooms').DataTable({
                            data: data,
                            columnDefs: [{
                                orderable: false,
                                className: 'select-checkbox',
                                targets: 0
                            } ],
                            select: {
                                style: 'os',
                                selector: 'td:first-child'
                            },
                            order: [[ 1, 'asc' ]]
                        });

                    } else {
                        console.log(result);
                        var table = $('#table-rooms');
                        table.find("tbody tr").remove();
                    }                    
                },
                error: function () {
                    console.log(result);
                    var table = $('#table-rooms');
                    table.find("tbody tr").remove();
                    alert('An error occured'); 
                }
            });
        }

    </script>
    {% endblock %}    
{% endblock %}